{% extends "nav.html" %}
{% block title %}
View File
{% endblock %}

{% block extraHead %}
<link href="https://mbraak.github.io/jqTree/jqtree.css" rel="stylesheet">
<link rel="stylesheet" href="https://rawgit.com/enyo/dropzone/master/dist/dropzone.css">
{% endblock %}

{% block body %}
<div class="container">
    <div class="header">
        <h3 class="text-muted">How To Upload a File</h3>
    </div>
    <hr/>
    <div>
        <div id="fileList"></div>
        Parent Directory Id: <input type="number" name="gallery_dir_id" readonly/><br />
        File Location: <input type="text" name="gallery_location" /><br />
        <input type="submit" value="Create Directory" class="span2"><br />

        <div id="galleryUpload">
            <input type="submit" value="Upload" class="span2">
        </div>
    </div>
</div>
{% endblock %}

{% block extraFooter %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqtree/1.3.5/tree.jquery.min.js"></script>
<script src="https://rawgit.com/enyo/dropzone/master/dist/dropzone.js"></script>
<script>
    $(function() {
        $.get("/api/get_dir_tree", function(data) {
            $('#fileList').tree({
                data: [data],
                autoOpen: 0
            });
            $('#fileList').bind(
                'tree.click',
                function(event) {
                    // The clicked node is 'event.node'
                    var node = event.node;
                    $('input[name="gallery_dir_id"]').val(node.id);
                }
            );
        });
        var myDropzone = new Dropzone('div#galleryUpload', {
            url: '/upload',
            paramName: "gallery-upload",
            uploadMultiple: false,
            autoProcessQueue: true,
            parallelUploads: 3,
            accept: function(file, done) {
                done();
            },
            sending: function(file, xhr, formData) {
                formData.append('gallery_location',
                    $('input[name="gallery_location"]').val());
                formData.append('gallery_dir_id',
                    $('input[name="gallery_dir_id"]').val());
            },
            complete: function(file) {
                this.removeFile(file);
            },
            success: function(file, response) {
                console.log("Uploaded file:");
                console.log(file);
                console.log("Response:");
                console.log(response);
            }
        });
    });
</script>
{% endblock %}
